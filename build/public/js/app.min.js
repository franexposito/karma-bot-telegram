var karmaBotApp=angular.module("karmaBotApp",["ngRoute","ngScrollbar","LocalStorageModule"]);karmaBotApp.config(["$routeProvider","$locationProvider","localStorageServiceProvider","$logProvider",function(t,e,r,o){e.html5Mode({enabled:!0,requireBase:!1}),o.debugEnabled(!0),r.setPrefix("karmaBot").setDefaultToCookie(!1),t.when("/",{templateUrl:"views/main.html",controller:"AppCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/logout",{template:" ",controller:"LogOutCtrl"}).otherwise({redirectTo:"/"})}]),karmaBotApp.service("gruposService",["$http",function(t){var e="";return{getGroups:r};function r(){return e.length>0?e:t.get("/api/groups/all").then(function(t){return e=t.data,t.data},function(t){})}}]),karmaBotApp.service("userService",["$http","localStorageService",function(t,e){return{getUser:r,SaveUser:c,DeleteUser:o,LogOut:i,IsLog:n,GetToken:a,IsStart:u};function r(){if(e.isSupported)return e.get("karma_user")}function o(){e.isSupported&&e.remove("karma_user")}function n(){return!1}function a(){return t.get("/api/users/GetToken").then(function(t){return t.data},function(t){})}function i(){return t.post("/logout").then(function(t){return t.data},function(t){})}function u(e){return t.post("/api/users/GetTokenAuth",{token:e}).then(function(t){return t.data},function(t){})}function c(t){e.isSupported&&e.set("karma_user",t)}}]),karmaBotApp.directive("krFillgauge",["$window","$timeout",function(t,e){return{restrict:"E",scope:{myGraph:"=",myIndex:"@",myCategory:"@"},templateUrl:"views/parts/fillgauge.html",link:function(r,o,n){var a,i,u;e(function(){var e=o.find("svg")[0],n=o.find(".s7")[0],c=$(e).height(),s=$(n).width(),l=(Math.min(c,s)-15)/2,p=(r.myGraph,t.d3),g=p.select(e).attr("id","fillgauge"+r.myIndex).attr("height",2*l+10),f=g.append("g");a=f.append("circle").attr("class","circle-resume").attr("r",l).attr("cx",s/2).attr("cy",l+10),i=f.append("circle").attr("class","circle-inner-solid").attr("r",l-7).attr("cx",s/2).attr("cy",l+10),u=f.append("text").attr("class","circle-text").attr("x",s/2).attr("y",l+10).text(0)}),r.$watch("myGraph",function(t){t&&u.text(r.myGraph)},!0)}}}]),karmaBotApp.directive("krVote",["$window",function(t){return{restrict:"E",scope:{myVote:"=",myIndex:"=",myType:"@"},templateUrl:"views/parts/votes.html"}}]),karmaBotApp.controller("LoginCtrl",["$scope","$rootScope","userService","$timeout","$location",function(t,e,r,o,n){var a,i=!0,u=0;t.saludo="Hola",r.GetToken().then(function(e){a=e.token,e.token===!1?t.token="Refresh the browser for generate a token":(t.token="/start "+e.token,c())}),e.body_class="login-body";function c(){i&&u<36&&(u+=1,r.IsStart(a).then(function(t){t.token===!1?o(c,5e3):(r.SaveUser(t.user),i=!0,n.path("/"))}).catch(function(t){}))}}]),karmaBotApp.controller("LogOutCtrl",["$location","userService",function(t,e){e.DeleteUser(),e.LogOut().then(function(e){t.path("/login")}).catch(function(t){})}]),karmaBotApp.controller("AppCtrl",["$scope","$rootScope","userService","gruposService",function(t,e,r,o){e.body_class="",t.user=r.getUser(),o.getGroups().then(function(e){t.groups=e,t.positiveVotes=n(),t.negativeVotes=a(),t.karma=t.positiveVotes-t.negativeVotes,t.votesRecieved=i("to"),t.votesSended=i("from")});function n(){var e=0;return angular.forEach(t.groups,function(r){angular.forEach(r.historyV,function(r){r.to===t.user.username&&1===r.vote&&(e+=1)})}),e}function a(){var e=0;return angular.forEach(t.groups,function(r){angular.forEach(r.historyV,function(r){r.to===t.user.username&&r.vote===-1&&(e+=1)})}),e}function i(e){for(var r=[],o=3,n=0,a=t.groups.length;n<a;n++)for(var i=0,u=t.groups[n].historyV.length;i<u;i++){var c=t.groups[n],s=t.groups[n].historyV[i];if(s[e]===t.user.username){var l={to:s.to,from:s.from,groupName:c.name,score:s.vote,date:s.date};r.push(l)}}return r.sort(function(t,e){return new Date(e.date)-new Date(t.date)}),r=r.slice(0,o)}}]),karmaBotApp.controller("NavCtrl",["$scope","gruposService","userService",function(t,e,r){e.getGroups().then(function(e){t.groups=e}),t.user=r.getUser()}]);